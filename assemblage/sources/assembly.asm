EXIT_EXC EQU 64
READ_EXC EQU 65
WRITE_EXC EQU 66
LOAD_ADRS EQU 0xF000
NIL EQU 0
STACK_ADRS EQU 0x1000

SP EQU R15
WR EQU R14
BP EQU R13
INT_SIZE EQU 2

ORG LOAD_ADRS
START main_

write_	LDQ 0, R1
	ADQ -2, SP
	STW BP, (SP)
	LDW BP, SP
	SUB SP, R1, SP

	LDW R0, BP
	ADQ 4, R0
	LDW R0, (R0)

	LDW WR, #WRITE_EXC
	TRP WR

	LDW R0, #NEWLINE
	LDW WR, #WRITE_EXC
	TRP WR

	LDW SP, BP
	LDW BP, (SP)
	ADQ 2, SP
	LDW WR, (SP)
	ADQ 2, SP
	JEA (WR)

read_	LDQ 0, R1
	ADQ -2, SP
	STW BP, (SP)
	LDW BP, SP
	SUB SP, R1, SP

	LDW R0, BP
	ADQ 4, R0
	LDW R0, (R0)

	LDW WR, #READ_EXC
	TRP WR

	LDW SP, BP
	LDW BP, (SP)
	ADQ 2, SP
	LDW WR, (SP)
	ADQ 2, SP
	JEA (WR)

main_	LDW SP, #STACK_ADRS
	LDQ NIL, BP
	LDQ 0, R1
	ADQ -2, SP
 	STW BP, (SP)
 	LDW BP, SP
	SUB SP, R1, SP

NEWLINE RSW 1
	LDW R3, #0x0a00
	STW R3, @NEWLINE

	ADQ -INT_SIZE, SP
	ADQ -INT_SIZE, SP
STRING0 string "Testing..."
	LDW R1, #STRING0
	STW R1, -(SP)
	JSR @write_

READINT0 RSB 4
	LDW R1, #READINT0
	STW R1, -(SP)
	JSR @read_

STRING1 string "Terminated"
	LDW R1, #STRING1
	STW R1, -(SP)
	JSR @write_

	LDW WR, #EXIT_EXC
	TRP WR
